<!doctype html>
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type">
		<title>extension «iWebEchoppe miscellanea» pour Opencart: permissions\droits sur les fichiers\dossiers sous Linux</title>
		<meta name="description" content="module «Base des tests» de l'extension «iWebEchoppe miscellanea»">
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
		<meta http-equiv="Content-Language" content="fr">
		<META NAME="robots" CONTENT="noindex,nofollow">
		<meta name="googlebot" content="DIRECTIVE">
		<link rel="stylesheet" type="text/css" href="./../a-inc-cmn-all-sites/a-css/style-bdd-documents.css">
		<script type="text/javascript" src="./../a-inc-cmn-all-sites/a-js/graphic-res-combined-and-shared-by-all-the-net/GoogleUtils.js" defer></script>
	</head>

	<!-- Begin Google traduction -->
	<header>
		<div id="google_translate_element"></div>
		<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=GoogleUtils.googleTranslateElementInit"></script>
	</header>
	<!-- End Google traduction -->

	<body>
		<header></header>

		<br><br><br>
		<h1>Aide pour résoudre des permissions\droits sur les fichiers\dossiers sous Linux</h1>

		<br><br><br>
		<h3>Introduction:</h3>
		<br>
		<p>Les permissions\privilèges sont donnés aux listes de contrôle d'accès (dites "ACL") via des droits "ugo", qui doivent être attribués à l'arborescence des répertoires et fichiers d'un site web, selon leur fonctionnalité. Certains fichiers sont exécutables, d'autres uniquement lisibles. La gestion des droits sous Linux n'est pas intuitive et nécessite une approche méthodique.</p>

		<br><br><br>
		<h3>Mnémotechnie: <span class="acronyme">Ugo</span> est mon ami pour attribuer des droits!</h3>
		<br>
		<p>Dans la logique "ugo", chaque lettre représente un groupe avec un rôle (et donc des privilèges) différent:</p>
		<ul>
			<li><b>u</b>: <b>U</b>ser-propriétaire\administrateur du site (ex.: <i>Jean</i>; mais ça pourrait être un logiciel comme <i>www-data</i> c'est-à-dire Apache). 
			Le <u>u</u>ser-créateur-propriétaire compose ce groupe <b>u</b> à lui tout seul, pour chaque fichier\dossier qu'il crée pour son site.</li>
			<li><b>g</b>: <b>G</b>roupe-logiciel (ex.: <code>www-data</code>, pour Apache (le serveur web) qui s’exécute sous l’identité "www-data", sur les distributions Linux; 
			"www-data" est à la fois un nom de compte <b>u</b>tilisateur (Cf. ci-dessus) et aussi un nom de <b>g</b>roupe-logiciel, 
			c'est-à-dire un groupe où l'on peut y ajouter d'autres logiciels-services web publiant eux aussi pour internet et ce, en sus d'Apache, donc).</li>
			<li><b>o</b>: <b>O</b>thers de l'internet, c'est-à-dire "les autres de l'internet" c'est-à-dire les internautes.</li>
		</ul>

		<br><br><br>
		<h3>Valeurs des permissions de base:</h3>
		<br>
		<p>Les droits sont attribués avec une valeur octale 
		(la composition d'une somme, dont le maximum vaut 8), 
		valeur octale résultant donc de la somme de trois composantes potentielles actionnelles applicables sur un fichier\dossier considéré, 
		valeur qui permet de distinguer les privilèges qu'à chacun des trois groupes existant, chacun selon son rôle considéré sur la ressource fichier\dossier considéré:</p>
		<ul>
			<li>Lecture (r): <b>4</b></li>
			<li>Écriture (w): <b>2</b></li>
			<li>Exécution (x): <b>1</b></li>
		</ul>
		<div class="note">
			<b>Attention:</b> Attribuer uniquement le droit de lecture (<code>4</code>) à <b>u</b> peut verrouiller l'accès à un dossier, car la navigation nécessite au moins <code>5</code> (<code>r+x</code>). En pratique, les permissions commencent souvent à <code>600</code> pour les fichiers.
		</div>

		<br><br><br>
		<h3>Attribution des droits selon Ugo:</h3>
		<br>
		<p><u>Prérequis:</u></p>
		<ul>
			<li>L'administrateur (ex: <i>Jean</i>) se connecte via FTP.</li>
			<li>Les hébergeurs comme IK ou OVH proposent des outils FTP/SSH pour gérer les permissions.</li>
			<li>La commande <span class="stabilo_noir">chmod</span> s'applique de manière récursive ou ciblée, souvent combinée avec <code>find</code>.</li>
		</ul>

		<p><b>Étapes à suivre:</b></p>
		<ol>
			<li>Changer le propriétaire (<code>chown -R Jean /web</code>). Cette commande change le "user" propriétaire sur toute l'arborescence émergée concernée, comme étant l'administrateur physique (ici, appelé Jean). Seul Jean, connecté, peut utiliser les privilèges du u.</li>
			<li>Modifier le groupe (<code>chgrp -R www-data /web</code>). Avec cette commande, le dossier <span class="stabilo_gris">"/web</span> se voit ajouter ""www-data" (c'est le nom donné au logiciel Apache) dans ses listes de groupes, 
				i.e. dans ses listes de <b>g</b>. Ainsi, seul www-data sera dans cette liste du g de /web</li>
			<li>Définir les permissions pour <b>u</b>, pour <b>g</b>, et pour <b>o</b> (o sont les others, les autres de l'internet, c'est-à-dire les internautes derrière leur navigateur). On doit définir pour chacun d'entre eux, leur valeur octale qui est une combinaison de read (=4 points) + write (=2 points) + eXecution (=1 point).</li>
		</ol>

		<br><br>
		<h4>&#9989; Bonnes pratiques pour les répertoires:</h4>
		<p>Permissions recommandées pour les répertoires (navigation, listage):</p>
		<ul>
			<li><span class="stabilo_noir">find /web -type d -exec chmod 750 {} +</span>: accès restreint au <b>g</b>roupe seul (accès minimaliste).</li>
			<li><span class="stabilo_noir">find /web -type d -exec chmod 755 {} +</span>: accès public (si nécessaire, accès maximaliste).</li>
		</ul>

		<br>
		<h4>&#10060; À éviter pour les répertoires:</h4>
		<div class="note" style="border-left: 4px solid #f44336;">
			<p>À éviter: <span class="stabilo_noir"><s>chmod -R 555</s></span>: <b>Risque de verrouillage</b> (navigation impossible sans droits <code>x</code>).</p>
		</div>

		<br><br>
		<h4>&#9989; Bonnes pratiques pour les fichiers:</h4>
		<p>Permissions recommandées pour les fichiers:</p>
		<ul>
			<li><span class="stabilo_noir">find /web -type f -exec chmod 640 {} +</span>: lecture seule pour au <b>g</b>roupe seul (accès minimaliste).</li>
			<li><span class="stabilo_noir">find /web -type f -exec chmod 644 {} +</span>: lecture publique (si nécessaire, accès maximaliste).</li>
		</ul>
		<p>Pour les fichiers sensibles: <span class="stabilo_noir">chmod 600</span> (accès réservé à <b>u</b> seul).</p>

		<br><br>
		<h4>&#10060; À éviter pour les fichiers:</h4>
		<div class="note" style="border-left: 4px solid #f44336;">
			<p>À éviter: <span class="stabilo_noir"><s>chmod -R 444</s></span>: <b>risque de verrouillage</b> (impossible de modifier le fichier).</p>
		</div>

		<br><br>
		<h4>&#128161; Dernier rappel</h4>
		<p>
			le fichier dit de la "base de données mySQL" est localisé ailleurs, généralement sous <span class="stabilo_gris">/var/...</span>, i.e. à un emplacement où l'on a aucun droit d'accès: bref, on ne s'y occupe que de droits CRUD pour l'admin (=~u) et pour les autres-others (=~o).
		</p>

		<!-- Composante {fast-}CGI rassemblée -->
		<br><br>
		<div class="cgi-documentation" style="border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
			<h2>&#128220; Documentation <span class="acronyme">{fast-}CGI</span>: cas particulier des scripts <span class="acronyme">CGI\FastCGI</span>:</h2>

			<p>
				Ce paragraphe est juste un complément d'information pour ceux dont la curiosité à propos des droits Ugo a été éveillée. 
				Pour parfaire cette culture générale des droits, ce paragraphe explique les droits concernant ce type de fichiers CGI\FastCGI. 
				<span class="stabilo_rouge">Pour faire fonctionner Opencart et ses extensions, la connaissance des fichiers CGI\FastCGI est hors sujet (pour autant que je sache et jusqu'à présent).
			</p>

			<h3>&#10070; Pourquoi les scripts <span class="acronyme">CGI\FastCGI</span> sont-ils différents?</h3>
			<p>
				Les scripts <strong>CGI</strong> et <strong>FastCGI</strong> ne sont ni des fichiers <code>.htm</code> ni des fichiers <code>.php</code>. 
				Ce sont des fichiers binaires compilés (écrits avec des EDI tes que Lazarus + (GDI ou Qt ou GTK ou fpGUI), ou alors MSEide + (MSEgui ou fpGUI) si, comme moi, 
				vous ne connaissez que le free-Pascal objet en dehors de PHP ^^), fichiers qui produisent leur propre code HTML: ils n'ont pas besoin d'être interprétés par l'interpréteur de code PHP qui transforme PHP en pages HTML, donc. 
				Leur exécution dépend du <strong>bit d'exécution</strong> (<code>x</code>) dans les permissions Linux, car ils sont <strong>compilés ou interprétés dynamiquement</strong> par le serveur web (Apache ou Nginx).
			</p>

			<h4>&#128295; Bit d'exécution obligatoire</h4>
			<p>
				Pour qu'un script CGI\FastCGI soit exécutable, il est <span class="stabilo_noir"><strong>obligatoire</strong></span> que son <strong>bit d'exécution</strong> (<code>x</code>) soit activé. La valeur octale des droits doit inclure <strong>au moins <code>1</code></strong> (pour <code>x</code>), généralement combinée avec <code>r</code> et <code>w</code> pour le propriétaire (<code>u</code>).
			</p>

			<h4>&#128221; Exemples de commandes</h4>
			<ul>
				<li>
					<span class="stabilo_noir"><code>chmod 750 public_html/cgi-bin/your-script.elf</code></span>:
					autorise l'exécution par <code>u</code> et <code>g</code> (ex: <code>www-data</code>), tout en restreignant l'accès aux autres (<code>o</code>).
				</li>
				<li>
					<span class="stabilo_noir"><code>chmod 755 public_html/cgi-bin/your-script.elf</code></span>:
					permet une exécution publique (si nécessaire pour un accès web).
				</li>
			</ul>

			<div class="note">
				<p>
					<strong>Pourquoi est-ce critique?</strong><br>
					Sans le bit <code>x</code>, le serveur web refusera de lancer le script, même avec des droits de lecture (<code>r</code>).
				</p>
			</div>

			<h4>&#9989; Bonnes pratiques {fast-}CGI</h4>
			<ul>
				<li><span class="stabilo_noir">chmod 750</span>: exécution restreinte (recommandé pour la sécurité).</li>
				<li><span class="stabilo_noir">chmod 755</span>: exécution publique (si accès web requis).</li>
			</ul>

			<h4>&#10060; À éviter absolument</h4>
			<div class="note" style="border-left: 4px solid #f44336;">
				<p>À éviter: <span class="stabilo_noir"><s>chmod 777</s></span>: risque majeur de sécurité (accès total à tous les utilisateurs).</p>
			</div>

			<h4>&#128257; Héritage des permissions</h4>
			<p>Pour propager les permissions aux sous-répertoires:</p>
			<ul>
				<li><span class="stabilo_noir">chmod g+s /web</span>: active l'héritage des droits pour le groupe.</li>
			</ul>

			<h4>&#128161; Note pour OpenCart</h4>
			<div class="note" style="border-left: 4px solid #2196F3;">
				<p>
					Si vos scripts CGI interagissent avec des modules OpenCart (ex: <code>/system/library/</code>), vérifiez que le groupe (<code>g</code>) est <code>www-data</code> pour éviter les conflits avec Apache.
				</p>
			</div>
		</div>

		<br><br><br>
		<h3>À savoir:</h3>
		<p>Sous Linux, une ACL est une combinaison "ugo". Un fichier\dossier ne peut appartenir qu'à <b>un seul groupe</b> et <b>une seule ACL</b> à la fois, contrairement à MS-Windows.</p>

		<br><br><br>
		<label id="REFERENCES" style="font-size: small;">
			*[1]: IK=Infomaniak; OVH="On Vous Héberge"; cgiwebhost=hébergement de fichiers *.cgi compilés permis, etc. = d'autres hébergeurs.
		</label>
		<aside></aside>
		<footer></footer>
	</body>
</html>
